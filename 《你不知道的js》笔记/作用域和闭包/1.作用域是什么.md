程序的变量存储在哪里？程序需要时如何去找到对应的变量？

有人设计出了一套规则，这个规则就叫做作用域。

### 一. 编译原理

#### 1. JS是一门编译性语言

（不是解释性语言）

在传统的编译语言流程中，程序的源代码在**执行**之前会经历3个步骤，称之为 **编译**（编译 → 执行）

- 词法分析

  以词为单位 ‘割开’ 代码。

- 语法分析

  将词构建成抽象语法树AST。

- 生成机器指令（引擎能执行的代码）

  将AST转化为一串机器指令并准备执行。



#### 2. JS的编译步骤复杂得多

首先，大部分情况下，JS的编译发生在代码执行前的几微妙，所以给它的编译时间很短。

JS引擎也用了各种方法来优化JS编译的性能。

### 二. 理解作用域

栗子↓

#### 1. 任务↓

处理  `var a = 2` 



#### 2. 3个角色↓

- **JS引擎**

  负责整个程序编译和执行JS。

- **编译器**

  JS引擎的朋友，负责词法分析，语法分析，生成机器指令。

- **作用域（可能有多个）**

  JS引擎的好朋友，负责收集并维护所有 声明的**变量** 组成的一系列查询规则，并确定当前执行的代码对这些变量的访问权限。

  即：通过作用域，并且有权限时，程序当前执行的代码才能够访问到某个变量。 



#### 3. 对话↓

 - 编译器： 
   - （- 当前作用域，你那有没有一个变量的名字已经叫a了？）
     - （- 有）忽略当前声明，接着编译下面的代码。
     - （- 没有）（- 那你在当前作用域声明一个变量吧，名字叫a。）
   - 生成机器指令
 - JS引擎：
   - 执行机器指令
     - （- 作用域，你那当前作用域有没有一个叫a的变量？）
       - （- 有）将2赋值给a。
       - （- 没有） 继续去外层嵌套作用域（上层作用域）查找变量a。
         - 若最终仍未找到，则报错。

#### 4 . 作用域嵌套

emmm，就是JS引擎在当前作用域没有找到需要的变量时，会去上层作用域找。直到全局作用域。

